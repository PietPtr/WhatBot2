

var QuoteModule = function(){
	var self = this;
	self.client = null;

	var fs = require('fs');
	var bannedNicks = ['Steam[b]ot', 'ExperimentalBot', 'dogie[b]', 'Pietdagamer[2]']

	self.quoteListener = function(nick, to, text, message) {
		if (text == '!quote') {
			fs.readFile(__dirname + '/textList.txt', function(err, data) {
				if (err) {
					throw err;
				}

				var messages = data.toString().split("\n");
				self.client.say(to, '"' + messages[randomInt(0, messages.length)] + '"');
			});
		}	
	}

	self.textGatherer = function(nick, to, text, message) {
		if (text[0] != '!' && bannedNicks.indexOf(nick) === -1 && text.length >= 30) {
			fs.appendFile(__dirname + '/textList.txt', text + '\n')
		}
		
	}

	/**
   * Unloads all listeners
  */
  self.unload = function(client) {
    client.removeListener('message', self.quoteListener);
    client.removeListener('message', self.textGatherer);
  };

  /**
   * Loads all listeners
  */
  self.load = function(client) {
    client.addListener('message', self.quoteListener);
    client.addListener('message', self.textGatherer);
    self.client = client;
  };

}

function randomInt(low, high) {
  return Math.floor(Math.random() * (high - low + 1) + low);
}

module.exports = new QuoteModule();